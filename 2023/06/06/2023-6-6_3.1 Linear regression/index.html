<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>3.1 Linear regression | Spencer</title><meta name="author" content="Spencer"><meta name="copyright" content="Spencer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="3.1.2 向量化加速123456%matplotlib inlineimport mathimport timeimport numpy as npimport torchfrom d2l import torch as d2l 1234n &amp;#x3D; 10000#10000维向量a &amp;#x3D; torch.on"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.mathming.ltd/2023/06/06/2023-6-6_3.1%20Linear%20regression/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":10,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: Spencer","link":"Link: ","source":"Source: Spencer","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '3.1 Linear regression',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-09 00:19:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">27</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-gallery"></i><span> Gallery</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images.pexels.com/photos/1509534/pexels-photo-1509534.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Spencer</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-gallery"></i><span> Gallery</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">3.1 Linear regression</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-06-05T16:00:00.000Z" title="Created 2023-06-06 00:00:00">2023-06-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-07-08T16:19:28.662Z" title="Updated 2023-07-09 00:19:28">2023-07-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="3.1 Linear regression"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="3-1-2-向量化加速"><a href="#3-1-2-向量化加速" class="headerlink" title="3.1.2 向量化加速"></a>3.1.2 向量化加速</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">10000</span><span class="comment">#10000维向量</span></span><br><span class="line">a = torch.ones(n)</span><br><span class="line">b = torch.ones(n)</span><br><span class="line">a, b</span><br></pre></td></tr></table></figure>
<pre><code>(tensor([1., 1., 1.,  ..., 1., 1., 1.]),
 tensor([1., 1., 1.,  ..., 1., 1., 1.]))
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span>():<span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;记录多次运行时间&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.times = []</span><br><span class="line">        self.start()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;启动计时器&quot;&quot;&quot;</span></span><br><span class="line">        self.tik = time.time()<span class="comment">#获取当前时间</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;停止计时器并且将时间记录在列表中&quot;&quot;&quot;</span></span><br><span class="line">        self.times.append(time.time() - self.tik)<span class="comment">#记录本次运行时间</span></span><br><span class="line">        <span class="keyword">return</span> self.times[-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">avg</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回平均时间&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times) / <span class="built_in">len</span>(self.times)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times)<span class="comment">#计算时间总和！！</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cumsum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回累计时间&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> np.array(self.times).cumsum().tolist()<span class="comment">#返回累计运行时间的列表！</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c = torch.zeros(n)</span><br><span class="line">timer = Timer()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    c[i] = a[i] + b[i]</span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.5</span>f&#125;</span> sec&#x27;</span></span><br></pre></td></tr></table></figure>
<pre><code>&#39;0.05257 sec&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">timer.start()</span><br><span class="line">d = a + b</span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.5</span>f&#125;</span> sec&#x27;</span></span><br><span class="line"><span class="comment">#显然直接用向量加法更快！</span></span><br></pre></td></tr></table></figure>
<pre><code>&#39;0.00014 sec&#39;
</code></pre><h2 id="3-1-3-normal-distribution-and-square-loss"><a href="#3-1-3-normal-distribution-and-square-loss" class="headerlink" title="3.1.3 normal distribution and square loss"></a>3.1.3 normal distribution and square loss</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">normal</span>(<span class="params">x, mu, sigma</span>):</span><br><span class="line">    p = <span class="number">1</span>/math.sqrt(<span class="number">2</span>*math.pi*sigma**<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> p * np.exp(-<span class="number">0.5</span> / sigma**<span class="number">2</span> * (x - mu)**<span class="number">2</span>)</span><br><span class="line"><span class="comment">#define a normal distribution</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = np.arange(-<span class="number">7</span>, <span class="number">7</span>, <span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#average and standard variance</span></span><br><span class="line">params = [(<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">2</span>), (<span class="number">0</span>, <span class="number">3</span>)]<span class="comment">#namely a couple of mu&#x27;s and sigma&#x27;s</span></span><br><span class="line">d2l.plot(x, [normal(x, mu, sigma) <span class="keyword">for</span> mu, sigma <span class="keyword">in</span> params], xlabel=<span class="string">&#x27;x&#x27;</span>, ylabel=<span class="string">&#x27;p(x)&#x27;</span>, figsize=(<span class="number">4.5</span>, <span class="number">2.5</span>), </span><br><span class="line">        legend=[<span class="string">f&#x27;mean <span class="subst">&#123;mu&#125;</span>, std <span class="subst">&#123;sigma&#125;</span>&#x27;</span> <span class="keyword">for</span> mu, sigma <span class="keyword">in</span> params])</span><br><span class="line"><span class="comment">#利用我们之前定义的函数画出三条图像，在matlab中考虑knocker积来画。</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/06/06/2023-6-6_3.1%20Linear%20regression/output_8_0.svg" alt="svg"></p>
<h2 id="3-2-linear-regression-from-zero"><a href="#3-2-linear-regression-from-zero" class="headerlink" title="3.2 linear regression from zero"></a>3.2 linear regression from zero</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#we generate a dataset with noise. Our task is to recover parameters from the finite samples in the dataset.</span></span><br><span class="line"><span class="comment">#we will use low dimension dataset</span></span><br><span class="line"><span class="comment">#使用线性模型参数w = [2, 3.4]&#x27;, b = 4.2和噪声epsilon, 假设epsilon服从正态分布</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">synthetic_data</span>(<span class="params">w, b, num_examples</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成y = Xw + b+noise&quot;&quot;&quot;</span></span><br><span class="line">    X = torch.normal(<span class="number">0</span>, <span class="number">1</span>, (num_examples, <span class="built_in">len</span>(w)))<span class="comment">#后面是矩阵大小</span></span><br><span class="line">    y = torch.matmul(X, w) + b<span class="comment">#matmul为矩阵乘法</span></span><br><span class="line">    y += torch.normal(<span class="number">0</span>, <span class="number">0.01</span>, y.shape)<span class="comment">#噪声标准差0.01</span></span><br><span class="line">    <span class="keyword">return</span> X, y.reshape((-<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"><span class="comment">#返回数据集， 线性输出结果列向量</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">true_w = torch.tensor([<span class="number">2</span>, -<span class="number">3.4</span>])<span class="comment">#this is our real param</span></span><br><span class="line">true_b = <span class="number">4.2</span></span><br><span class="line">features, labels = synthetic_data(true_w, true_b, <span class="number">1000</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;features:&#x27;</span>, features[<span class="number">0</span>], <span class="string">&#x27;\nlabel:&#x27;</span>, labels[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(features[:,(<span class="number">1</span>)])</span><br></pre></td></tr></table></figure>
<pre><code>features: tensor([-0.4575,  1.1481]) 
label: tensor([-0.6028])
tensor([ 1.1481e+00,  9.8841e-01,  3.5535e-01,  2.0784e+00,  9.6879e-01,
         1.5259e+00,  2.0957e+00, -1.8084e+00, -4.5611e-02, -2.8632e-01,
         1.1861e-01,  1.2378e+00, -1.4917e+00, -1.4077e-02, -8.8317e-01,
        -3.6147e-01,  9.3682e-01, -8.3408e-03,  2.8196e-01,  1.5797e+00,
         1.8961e-01, -1.1522e+00,  2.0520e-01, -6.0677e-01,  2.8371e-01,
        -1.8548e+00, -1.0169e+00, -1.2417e+00, -7.8944e-01,  6.5647e-01,
        -1.3798e+00,  8.5492e-01,  1.3620e+00,  2.1012e-01, -2.8030e-02,
        -7.9160e-02, -1.8883e-01, -1.4650e+00, -1.5059e+00,  5.3730e-01,
        -3.6419e-01, -2.5970e-01, -2.9555e-01,  7.3052e-01,  2.0045e+00,
        -6.2671e-01, -1.5374e-01, -1.8446e+00, -1.9459e-01,  6.2921e-01,
         4.2467e-02, -1.8700e+00, -1.8505e+00, -1.5815e+00,  9.1741e-01,
        -2.7313e+00, -4.8553e-01,  1.0087e+00, -5.2039e-01, -2.9656e-01,
        -9.1277e-01, -1.8571e+00, -1.1047e+00,  1.3227e+00,  8.7071e-01,
         2.9789e-01,  2.1700e+00, -2.6391e+00,  1.2253e-01, -1.7574e-01,
         8.7608e-01, -4.0556e-01,  1.9379e+00, -1.8671e+00,  3.0901e-01,
        -6.7684e-01,  3.1759e-01,  3.7318e-01, -1.2070e+00, -2.8530e-01,
         1.7684e-01,  8.0286e-01,  2.3324e+00, -1.0233e+00,  5.9065e-01,
        -1.1620e+00, -7.2939e-01, -1.0113e+00, -2.4611e-01,  2.1603e+00,
        -4.6869e-01,  4.5667e-01,  8.1412e-02, -1.5250e+00,  9.1282e-01,
        -6.6413e-02,  1.7847e+00,  1.0840e+00, -1.4668e+00, -7.6567e-01,
        -1.0015e+00, -2.3842e-03,  2.2501e+00,  7.9039e-01, -2.3140e-02,
         2.3391e+00, -6.3166e-01,  1.5859e+00,  4.9477e-01, -7.8896e-01,
        -1.1146e+00, -1.3595e+00,  3.8490e-01,  5.7789e-02,  1.8755e-01,
         3.0663e-02,  1.5449e-01,  5.4152e-01,  1.0721e+00, -7.6712e-01,
         8.5919e-01, -3.2355e-01,  8.8787e-01,  8.9284e-01, -1.1509e+00,
        -1.0984e+00,  6.9687e-01,  4.8890e-01, -1.6014e-01,  1.1933e-01,
         1.8930e-01, -1.5231e+00, -1.1571e+00, -1.5938e+00,  3.7390e-02,
         1.1513e+00, -1.9291e+00,  1.7362e+00, -2.2732e-02,  3.8519e-01,
        -5.1800e-01,  6.5560e-01,  5.2895e-01,  6.2111e-01,  7.1219e-01,
        -1.5480e+00, -8.2423e-02,  1.2572e+00, -1.6600e+00, -6.6887e-01,
        -6.4396e-01, -1.8052e+00,  4.6123e-01,  1.3803e+00, -7.3163e-01,
         3.9166e-01, -1.0357e+00, -2.5712e-02,  2.6065e+00,  1.4915e-01,
         1.4722e+00, -4.2426e-01,  1.5963e-01, -1.2018e+00, -2.8747e-01,
         5.6584e-01, -4.2296e-01,  2.0545e-01, -3.6279e-01,  2.4457e+00,
        -4.3528e-02,  1.8527e+00, -1.4745e+00,  9.0513e-01, -1.1770e+00,
         3.2235e-01, -1.6264e+00,  2.9787e-01, -2.5515e-01,  3.8579e-01,
         2.9109e-01, -1.8794e+00, -3.8222e-01,  1.4327e+00,  1.2353e+00,
         2.1096e+00, -3.6490e-01, -2.1201e+00, -1.2036e+00,  3.1987e-01,
         5.9609e-01,  1.2725e-01, -9.6513e-01,  7.3614e-01,  1.1720e+00,
        -1.1179e+00, -2.4735e-01, -9.3840e-01, -5.9294e-01, -7.0450e-01,
        -1.6842e-01, -9.8896e-01, -1.8894e-01, -7.6063e-02, -1.1151e+00,
         1.8027e-01, -1.2681e+00, -5.0569e-01,  4.2060e-01, -5.1863e-01,
        -6.1278e-01, -7.2373e-01,  1.6779e-02,  1.0886e+00,  4.3431e-01,
        -1.5948e+00,  9.9059e-01, -1.4882e-01,  2.8052e-01,  2.1443e+00,
         1.9607e+00,  3.8806e-01,  2.8489e+00,  2.7184e-01, -3.0007e-01,
         2.9903e-01,  2.8759e-01, -1.2914e+00,  7.9686e-01, -1.0355e+00,
         4.1506e-01,  2.7759e-02,  2.9032e-01,  1.9015e-01,  6.4119e-01,
         1.0285e+00, -1.7690e+00, -6.2829e-01,  6.2969e-01, -9.9775e-01,
         1.0963e-01,  1.4626e-01, -7.9280e-01,  7.6115e-01,  1.3151e+00,
        -5.0517e-01, -1.5206e+00,  3.3245e-01,  1.8158e+00, -1.1382e+00,
         1.3609e-01,  2.0802e-01,  2.3387e+00,  1.2389e+00, -1.9891e+00,
         1.4855e+00, -2.0487e+00, -1.0958e+00,  6.7396e-02, -3.1978e-01,
         2.0079e-01, -1.2860e+00, -2.6958e-01,  5.9093e-01, -1.0039e+00,
         1.0405e+00, -1.6445e+00, -2.3928e+00, -2.5411e+00,  5.7786e-02,
        -5.6163e-01, -1.3880e+00, -1.3622e+00,  2.0252e-01, -3.8418e-01,
         1.0342e+00,  3.3516e-01, -5.5250e-01,  2.6750e-01, -1.6293e+00,
        -2.2705e+00, -3.6701e-01, -4.4601e-01,  1.0332e-01, -9.0555e-01,
        -7.8224e-01,  6.5012e-01,  2.0365e-01, -9.7166e-01, -8.8770e-01,
        -1.1458e-01,  6.1896e-01,  3.8177e-02,  7.9368e-01,  8.5608e-01,
        -7.3723e-01,  4.4987e-01,  7.0388e-02, -2.3882e+00, -1.2298e+00,
        -9.4504e-01,  7.4099e-01,  1.6731e-01,  1.4965e+00,  5.2760e-01,
         3.8883e-01,  1.3643e+00, -4.6518e-01,  2.4443e-01,  3.3352e-01,
         1.2131e+00,  7.7936e-01,  1.6513e+00,  3.9003e-01,  2.6580e+00,
        -2.0143e+00,  4.6442e-01,  1.0394e+00,  6.2862e-01, -1.1107e-01,
        -3.1953e-01,  2.8409e-01, -2.2856e-01, -1.2910e+00,  4.0124e-01,
        -1.4591e+00, -6.3800e-01, -7.6559e-02,  1.5400e+00, -4.4240e-01,
         7.6727e-01,  5.2881e-01,  3.3930e-01, -5.6261e-01,  9.2551e-02,
         1.0922e+00, -8.5927e-03, -1.9315e+00, -8.0120e-01, -3.7330e-01,
        -9.0129e-01, -5.0834e-01,  1.8708e+00, -2.5837e-02, -1.8937e-01,
        -2.2318e+00,  1.1952e+00, -2.0461e+00, -8.2401e-01, -1.2479e+00,
         1.6429e-01,  1.0243e+00,  2.4229e-01, -4.3179e-01, -5.3647e-01,
        -1.2427e+00,  9.8076e-01,  2.1812e+00, -4.8656e-01, -1.6169e+00,
         5.3849e-01,  1.5744e+00,  1.6007e+00,  8.7652e-01,  1.2158e+00,
         2.0958e+00, -1.6757e+00, -5.7488e-01, -1.6686e+00, -8.7088e-01,
        -1.0723e+00,  2.4962e-01,  3.1641e-01, -7.9529e-01, -4.0261e-01,
        -3.8990e-01, -4.7629e-01,  9.0027e-01, -6.2792e-01,  1.2507e+00,
        -2.0434e-01,  1.1350e+00, -5.6942e-01,  3.3200e-01, -6.2645e-01,
         6.6778e-01,  1.2263e+00,  1.4614e+00,  9.3139e-01, -5.3332e-01,
        -4.6097e-02, -1.9035e+00, -1.0132e-01,  1.7642e-02, -9.5453e-01,
         7.9801e-02, -7.4119e-01, -1.8454e-01, -9.8458e-01,  2.6712e-01,
        -6.9740e-01,  2.0131e-01,  6.5156e-01,  5.0564e-02, -6.6864e-01,
        -5.5951e-01,  1.6883e+00,  5.6423e-01, -1.2320e+00,  6.2235e-01,
        -3.6802e-01,  1.7606e-02, -8.9760e-02,  8.4216e-02,  2.3550e+00,
        -6.1954e-01,  1.1986e+00,  1.4307e-01, -1.2371e+00,  6.1353e-01,
        -4.7802e-01, -8.9870e-01,  2.4927e-01,  1.2539e+00,  4.6585e-01,
        -5.7510e-01, -1.4058e+00,  6.8614e-01,  1.0716e+00, -1.1346e+00,
         2.0603e-01,  3.1547e-01,  3.3887e-01,  1.0074e+00,  1.8888e+00,
        -6.0657e-01, -6.4736e-01,  1.1325e+00,  1.1908e+00,  2.2778e+00,
         2.0696e+00, -5.1126e-01,  6.0378e-01, -9.2561e-01,  8.2603e-01,
        -5.6075e-01,  1.2561e-02,  4.7810e-01,  5.9240e-01,  1.0609e+00,
        -6.5395e-01, -3.8559e-02, -3.1292e+00,  2.4227e+00,  6.3595e-01,
        -2.8610e-01,  6.5506e-01,  1.6298e+00, -5.9440e-01, -2.3867e+00,
         3.7490e-01, -2.8954e-01,  1.9887e+00,  2.1178e+00, -9.4124e-01,
        -2.1529e-01, -3.3774e-01, -2.5555e-01,  4.5399e-01,  8.2870e-01,
        -1.9606e+00,  1.8591e+00,  8.9065e-01, -1.1209e+00,  8.5078e-01,
        -5.0887e-01,  1.0496e-01,  7.8327e-01,  1.6164e+00, -9.9667e-01,
        -1.2325e+00, -3.5175e-01, -1.2760e-01,  1.2511e+00,  5.7518e-01,
         5.7423e-01,  3.7567e-02,  1.8558e-01,  5.8916e-01, -9.9956e-01,
        -1.1871e+00, -1.3949e-01,  7.8632e-01,  5.4783e-01, -2.5953e-01,
        -7.0179e-01,  1.3462e+00, -8.7076e-01,  1.5781e+00, -1.6149e+00,
        -9.4347e-01, -1.0031e+00, -9.5817e-01,  5.4513e-01,  1.8137e-01,
         7.3919e-01,  8.8540e-01, -2.0286e-01,  7.7634e-01,  7.3887e-01,
        -9.2417e-01, -5.8629e-01, -9.6122e-01, -6.4402e-01,  1.0313e+00,
         9.3293e-01, -2.0455e+00,  6.5080e-01, -2.3454e+00, -4.2221e-01,
        -1.7840e+00, -1.5330e+00, -3.0028e-01, -9.0652e-01,  5.7490e-01,
        -1.3215e+00, -5.2164e-02, -1.3944e+00,  4.6915e-01, -1.3685e+00,
        -2.2256e+00,  2.6487e-01, -2.6672e-02,  9.9761e-01, -1.3467e+00,
         8.3699e-01, -1.7368e-01, -2.7459e-01,  1.1095e-01, -2.1293e+00,
        -8.2726e-01,  1.2120e+00, -5.2558e-01, -1.9627e-01,  4.5909e-02,
         1.2375e-01,  1.1702e+00, -4.9554e-02,  2.8394e-01, -1.5373e+00,
         1.6364e+00, -7.3641e-01, -9.1173e-01,  2.0838e+00, -6.4926e-01,
        -3.9731e-01,  2.7819e-01,  4.8103e-01,  1.9605e+00, -7.4808e-01,
         8.9170e-01, -6.3474e-01, -7.3605e-01,  2.7312e+00, -1.2479e+00,
         5.9305e-01, -1.9004e+00,  5.2773e-01,  1.2009e+00,  2.4878e-01,
         3.9960e-02,  1.1254e+00, -1.2421e+00,  1.6638e+00, -4.2698e-01,
        -8.6493e-01,  7.9775e-01,  1.5701e+00, -1.4982e+00, -3.6172e-01,
         2.0635e+00,  3.1505e-01, -1.3707e+00,  6.8623e-02, -8.3243e-02,
         1.6411e+00, -8.7246e-01,  1.2962e-01,  2.5374e-01,  9.3570e-01,
        -2.1959e-01, -6.3309e-01,  5.2649e-01,  6.5101e-01, -8.0604e-01,
         2.3749e-01, -2.2694e-01,  6.4538e-01,  3.5337e-01, -9.6457e-01,
        -1.2333e+00,  2.7997e-01, -2.0663e-01,  2.3671e+00,  9.3082e-01,
         7.3876e-01,  1.8297e-01,  3.0784e-01, -2.0485e-01, -1.4161e+00,
         1.2005e+00, -1.3524e+00, -9.8312e-01, -2.8585e-02,  8.3377e-01,
         2.0012e-01, -1.0599e+00, -1.6392e+00, -1.1237e+00, -7.3808e-01,
         9.0606e-02, -3.8058e-01,  1.4705e+00,  8.4527e-01,  9.8091e-02,
         1.3605e+00, -5.5692e-03, -1.0698e+00,  6.9970e-01, -2.0957e+00,
        -1.3866e+00,  1.0081e+00, -9.4732e-01, -1.5614e+00,  1.0418e+00,
        -1.2773e+00, -6.1403e-01, -7.7416e-01, -3.1242e-01, -7.1166e-01,
         6.4152e-01,  1.0537e+00,  2.6068e-01,  9.9155e-02,  3.6387e-01,
        -5.6042e-02, -9.2726e-01,  7.4153e-01, -1.3334e+00, -3.5452e-01,
         1.8230e-01, -1.4518e-01, -4.9744e-01,  2.9926e-01, -1.1999e+00,
        -1.0276e+00, -2.0264e-01,  9.9026e-02, -5.8485e-03, -9.3419e-01,
         1.1419e+00, -1.0526e+00, -4.2708e-02,  1.7832e+00,  9.0260e-01,
        -8.5001e-02,  7.0745e-01, -1.5511e+00, -1.0399e+00,  1.4423e+00,
         2.5840e-01,  1.3650e+00, -4.1277e-01,  1.1814e+00,  1.9051e-01,
        -8.4195e-01, -6.3608e-01, -8.2525e-01,  2.9556e-02,  1.5895e+00,
         5.4681e-01, -7.4028e-01, -1.8888e+00, -3.8418e-01,  6.2783e-01,
         2.6117e-01,  1.7963e+00, -1.0656e+00,  2.9323e-01,  8.8196e-01,
        -1.6574e+00, -8.4709e-01, -3.0478e-01, -1.4116e+00,  2.0713e+00,
        -7.1377e-01, -3.1828e-01,  6.0991e-01, -1.2600e-01, -1.1872e+00,
         2.5949e+00, -2.1323e-01, -4.9387e-01,  1.3590e-01,  2.7005e-01,
         4.9349e-02,  1.7641e+00,  5.5424e-01, -2.8919e-01, -1.1024e+00,
        -5.4493e-01,  2.8734e-01,  4.9375e-02,  2.7105e+00, -1.4239e+00,
        -6.9621e-01,  6.8720e-02, -8.6293e-01,  1.0441e+00, -8.4265e-01,
         3.4621e-01, -9.4755e-01,  1.6345e+00,  2.4400e-01, -6.6802e-01,
        -5.8259e-01, -3.4806e-02, -7.5941e-01,  1.0871e+00,  5.7423e-01,
         1.4147e+00,  9.9963e-01,  8.7708e-01,  9.2887e-01, -3.8470e-01,
         7.3699e-01, -9.9289e-02, -1.8127e-01,  8.4384e-01, -1.7517e-01,
        -8.2891e-01,  3.9462e-01,  2.2936e-01, -1.4852e+00, -1.0159e+00,
        -3.3372e-01, -4.3101e-01, -6.1192e-01, -1.0163e+00,  1.0189e+00,
        -1.4249e-01, -3.1265e-01, -2.6392e-01, -2.6849e+00, -4.8196e-01,
        -4.6253e-02, -2.6939e-01,  4.9775e-01,  2.2392e+00, -6.4311e-01,
        -2.4017e-02,  4.2888e-01,  8.5980e-01, -1.1387e-01, -4.3800e-01,
        -7.3540e-01,  1.0186e+00, -1.0442e+00, -1.1324e+00, -6.1361e-01,
        -7.2583e-01, -9.3297e-01,  5.7577e-01, -9.6112e-01,  8.0874e-01,
         2.5687e-01, -6.4977e-01,  4.4468e-02, -4.6040e-01, -6.9195e-01,
         2.6161e-01, -7.3509e-01, -1.5686e+00, -5.9142e-01,  3.1386e-01,
         6.3763e-01,  4.0360e-01, -5.1863e-01,  8.7735e-01, -1.0085e+00,
        -4.3077e-01, -2.3868e+00, -9.3748e-01, -4.3363e-01,  1.3374e+00,
         1.0526e+00, -1.5137e+00,  1.5175e+00,  1.9621e+00,  5.9761e-02,
        -6.6585e-01, -5.7567e-01,  1.8836e+00, -4.0392e-01, -1.6843e+00,
        -6.2651e-02, -5.6046e-01, -2.2240e+00,  2.2366e+00,  7.4441e-01,
         8.6763e-01,  2.7160e-02,  6.1294e-01, -1.3371e+00, -1.4363e+00,
         3.7063e-01,  3.2868e-01,  1.4252e+00,  1.9193e+00,  4.6192e-01,
        -6.5172e-01,  1.0483e+00, -2.0439e+00, -4.3385e-01, -4.1280e-01,
         2.1602e+00, -3.0209e-01, -1.3598e+00, -9.2362e-01,  6.8442e-01,
         1.5070e+00, -1.3786e+00,  2.0884e-01, -1.2019e+00,  1.5919e-01,
        -5.1237e-01, -6.4286e-01, -5.4308e-01, -1.6116e-01,  3.2348e-01,
        -9.9109e-01,  3.9232e-01, -5.3482e-01, -1.1709e+00, -7.9754e-01,
         3.1636e-01, -1.1140e+00, -8.9587e-01, -1.0187e+00,  3.2878e-01,
        -8.7841e-01, -1.0270e+00, -4.0047e-01,  9.1419e-01, -4.1257e-01,
        -3.4638e-01, -1.0262e+00,  2.5113e+00, -1.7556e+00, -8.8387e-01,
         1.2796e+00,  5.0357e-02, -8.0814e-02,  1.1154e+00, -4.7198e-01,
         3.3411e-01, -3.3916e-01,  6.1048e-01,  1.1607e+00, -1.4151e-01,
         1.1891e+00, -1.4370e-02, -4.7600e-01,  9.1887e-01,  1.1997e-01,
         1.2459e+00, -1.6652e+00,  7.1569e-01, -9.8907e-02,  1.0175e+00,
        -8.4436e-01,  1.2284e+00, -1.4385e-01, -1.1966e+00,  6.0931e-01,
        -5.9934e-01, -2.0330e-01,  2.1682e-01, -1.5576e+00, -7.3551e-01,
         8.3409e-02, -1.2729e+00,  3.7821e-01, -6.0331e-01, -5.4615e-01,
         4.1880e-01, -1.2772e+00,  5.8423e-01,  6.4823e-01, -9.0434e-01,
        -1.7290e-01,  1.0629e-01, -4.2987e-01,  2.7938e+00,  3.7136e-01,
        -4.6170e-01, -4.2099e-01,  1.3325e-01, -3.4060e-01,  9.4501e-01,
         4.2017e-01, -8.6550e-01,  7.3243e-02,  1.9991e-01,  8.7975e-01,
        -1.3850e+00, -1.4591e+00, -2.0303e-01, -1.0262e+00, -9.9105e-01,
         1.5270e+00, -7.0185e-02, -9.4997e-01, -1.0364e-01, -1.1562e+00,
         8.3660e-01, -8.9686e-01, -1.1466e+00, -2.6425e+00, -1.1398e+00,
         2.0886e-01,  7.1526e-01, -3.0458e-01, -7.2149e-01, -7.1204e-02,
        -5.7747e-01, -5.9964e-01, -3.0580e-01,  1.9363e-01, -1.2074e+00,
        -1.2838e-01, -2.5453e-01, -1.8684e-01,  1.4170e+00, -1.9690e+00,
         1.9070e+00,  9.0862e-01, -3.0649e-01,  6.8586e-01,  1.9581e-01,
         2.9553e-01,  2.0426e-02, -4.9903e-01,  7.2440e-01, -2.3443e+00,
         5.7277e-01,  3.9135e-01,  6.4137e-01,  7.8038e-01,  3.2200e-01,
        -7.8534e-01,  2.1155e+00, -2.3740e-01, -8.0613e-01,  7.0055e-01,
         2.1210e-01, -1.0981e+00,  2.7863e-01, -4.4150e-02,  2.5538e-01,
         8.5349e-01,  6.0327e-01,  7.5350e-01,  9.8726e-01, -1.6799e+00,
        -1.6166e-01,  1.1238e-01, -7.9880e-02, -2.5753e-01,  1.1932e-01,
         1.2365e+00,  8.5960e-02,  5.5032e-01,  7.7533e-01, -1.1113e-01,
         2.1430e-01, -6.1338e-02, -1.9932e-01, -6.8872e-01, -2.0505e-01,
        -1.8301e+00, -7.6811e-01, -7.4837e-02, -6.5999e-01,  3.8283e-01,
        -4.1343e-01, -3.0340e-01,  1.2524e+00, -6.2270e-01, -4.8251e-01])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Generate points graph between the second feature and labels</span></span><br><span class="line">d2l.set_figsize()</span><br><span class="line">d2l.plt.scatter(features[:, <span class="number">1</span>].detach().numpy(), labels.detach().numpy(), <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2023/06/06/2023-6-6_3.1%20Linear%20regression/output_13_0.svg" alt="svg"></p>
<h2 id="3-2-2-read-the-dataset"><a href="#3-2-2-read-the-dataset" class="headerlink" title="3.2.2 read the dataset"></a>3.2.2 read the dataset</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#When we are training the model, we need to traverse the whole dataset.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">data_iter</span>(<span class="params">batch_size, features, labels</span>):<span class="comment">#generate batch with batch_size</span></span><br><span class="line">    num_examples = <span class="built_in">len</span>(features)</span><br><span class="line">    indices = <span class="built_in">list</span>(<span class="built_in">range</span>(num_examples))</span><br><span class="line">    <span class="comment">#the sample is read randomly without specific orders</span></span><br><span class="line">    random.shuffle(indices)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, num_examples, batch_size):</span><br><span class="line">        batch_indices = torch.tensor(</span><br><span class="line">            indices[i:<span class="built_in">min</span>(i + batch_size, num_examples)])</span><br><span class="line">        <span class="keyword">yield</span> features[batch_indices], labels[batch_indices]</span><br><span class="line">        <span class="comment">#every batch consists of a group of feature and a group of label with number of batch_size, namely batch_size row.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter(batch_size, features, labels):</span><br><span class="line">    <span class="built_in">print</span>(X, <span class="string">&#x27;\n&#x27;</span>, y)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#输出一个小batch!我们如果继续执行，会连续不断获得小批量，知道遍历结束。</span></span><br></pre></td></tr></table></figure>
<pre><code>tensor([[-1.5650,  1.0609],
        [-0.9305, -1.8794],
        [-0.4093, -0.9996],
        [ 0.7869, -0.9384],
        [ 0.1738, -0.6689],
        [ 1.6200, -0.0613],
        [-0.5328,  0.2143],
        [-0.2533,  2.0045],
        [ 0.9031, -0.9043],
        [ 1.3816, -1.5059]]) 
 tensor([[-2.5447],
        [ 8.7360],
        [ 6.7868],
        [ 8.9856],
        [ 6.8253],
        [ 7.6404],
        [ 2.4112],
        [-3.1235],
        [ 9.0686],
        [12.0905]])
</code></pre><h2 id="3-2-3-Initialize-model-parameters"><a href="#3-2-3-Initialize-model-parameters" class="headerlink" title="3.2.3 Initialize model parameters"></a>3.2.3 Initialize model parameters</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#比如我们将偏置先置为0，通过均值为0，标准差为0.01正态分布中臭氧随机数来初始化权重w。</span></span><br><span class="line"><span class="comment"># w = torch.normal(0, 0.01, size=(2, 1), requires_grad = True)</span></span><br><span class="line"><span class="comment"># b = torch.zeros(1, requires_grad = True)</span></span><br><span class="line">w = torch.zeros((<span class="number">2</span>, <span class="number">1</span>), requires_grad = <span class="literal">True</span>)</span><br><span class="line">b = torch.zeros(<span class="number">1</span>, requires_grad = <span class="literal">True</span>)</span><br><span class="line">w, b<span class="comment">#these are random params, we then upgrade these params using small gradient descent until they match our data.</span></span><br></pre></td></tr></table></figure>
<pre><code>(tensor([[0.],
         [0.]], requires_grad=True),
 tensor([0.], requires_grad=True))
</code></pre><h2 id="3-2-4-define-model"><a href="#3-2-4-define-model" class="headerlink" title="3.2.4 define model"></a>3.2.4 define model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">linreg</span>(<span class="params">X, w, b</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;线性回归模型&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> torch.matmul(X, w) + b</span><br></pre></td></tr></table></figure>
<h2 id="3-2-5-define-loss-function"><a href="#3-2-5-define-loss-function" class="headerlink" title="3.2.5 define loss function"></a>3.2.5 define loss function</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">squared_loss</span>(<span class="params">y_hat, y</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;均方损失&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (y_hat - y.reshape(y_hat.shape)) ** <span class="number">2</span> / <span class="number">2</span><span class="comment">#即对矩阵每个对应元素算一下平方误差</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-6-define-optimization-algorithm"><a href="#3-2-6-define-optimization-algorithm" class="headerlink" title="3.2.6 define optimization algorithm"></a>3.2.6 define optimization algorithm</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sgd</span>(<span class="params">params, lr, batch_size</span>): <span class="comment">#@save params are w and b, sgd is small gradient descent.</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;小批量随机梯度下降&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">            param -= lr * param.grad / batch_size<span class="comment">#之前学的自动微分相减的过程</span></span><br><span class="line">            param.grad.zero_()<span class="comment">#清空梯度，不积累</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#we use data_iter to traverse the whole dataset, and we set the times of training as num_epochs. Num_epochs and </span></span><br><span class="line"><span class="comment">#learning rate are hyperparameters.</span></span><br><span class="line">lr = <span class="number">0.03</span></span><br><span class="line">num_epochs = <span class="number">3</span><span class="comment"># we run 3 times</span></span><br><span class="line">net = linreg<span class="comment">#net is just linreg</span></span><br><span class="line">loss = squared_loss<span class="comment">#loss is just squared_loss</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter(batch_size, features, labels):</span><br><span class="line">        l = loss(net(X, w, b), y)<span class="comment">#X 和 y的小批量损失,也就是预测结果和真实结果比较一遍得到损失大小</span></span><br><span class="line">        <span class="comment">#net is a neural network model, which accepts input X, then set weight w and bias b to calculate and obtain results.</span></span><br><span class="line">        l.<span class="built_in">sum</span>().backward()<span class="comment">#计算和函数对分量求导,也就是sgd函数中的param.grad部分</span></span><br><span class="line">        sgd([w, b], lr, batch_size)</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():<span class="comment">#every cycle we clean up the gradient.</span></span><br><span class="line">        train_l = loss(net(features, w, b), labels)<span class="comment">#the whole loss during the training process.</span></span><br><span class="line">        <span class="comment">#according the best params to calculate the results and then compare with the labels originally.</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;epoch<span class="subst">&#123;epoch + <span class="number">1</span>&#125;</span>, loss<span class="subst">&#123;<span class="built_in">float</span>(train_l.mean()):f&#125;</span>&#x27;</span>)<span class="comment">#timely print the training time</span></span><br></pre></td></tr></table></figure>
<pre><code>epoch1, loss0.029253
epoch2, loss0.000097
epoch3, loss0.000049
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Because the dataset is made by ourselves, so we know the real params w and b.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;w的估计误差：<span class="subst">&#123;true_w - w.reshape(true_w.shape)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;b的估计误差：<span class="subst">&#123;true_b - b&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>w的估计误差：tensor([ 0.0002, -0.0004], grad_fn=&lt;SubBackward0&gt;)
b的估计误差：tensor([0.0003], grad_fn=&lt;RsubBackward1&gt;)
</code></pre></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://www.mathming.ltd">Spencer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://www.mathming.ltd/2023/06/06/2023-6-6_3.1%20Linear%20regression/">http://www.mathming.ltd/2023/06/06/2023-6-6_3.1%20Linear%20regression/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a></div><div class="post_share"><div class="social-share" data-image="https://images.pexels.com/photos/1509534/pexels-photo-1509534.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/01/2023-7-1-K-means%E7%AE%97%E6%B3%95python%E5%AE%9E%E7%8E%B0/"><img class="prev-cover" src="https://images.pexels.com/photos/1903702/pexels-photo-1903702.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">K-means算法python实现</div></div></a></div><div class="next-post pull-right"><a href="/2023/06/05/2023-6-5_2.6%20Probability%20and%20Statistics/"><img class="next-cover" src="https://images.pexels.com/photos/1509534/pexels-photo-1509534.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">2.6 Probability and Statistics</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/06/02/2023-6-2_homework1_preprocess_dataset/" title="homework1 preprocess dataset"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-02</div><div class="title">homework1 preprocess dataset</div></div></a></div><div><a href="/2023/06/05/2023-6-5_2.6%20Probability%20and%20Statistics/" title="2.6 Probability and Statistics"><img class="cover" src="https://images.pexels.com/photos/1509534/pexels-photo-1509534.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-05</div><div class="title">2.6 Probability and Statistics</div></div></a></div><div><a href="/2023/06/01/2023-6-1_deep_learning_pre_knowledge/" title="deep learning pre knowledge"><img class="cover" src="https://images.pexels.com/photos/1903702/pexels-photo-1903702.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-01</div><div class="title">deep learning pre knowledge</div></div></a></div><div><a href="/2023/06/03/2023-6-3_2.3Linear%20Algebra/" title="Linear Algebra with pytorch"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-03</div><div class="title">Linear Algebra with pytorch</div></div></a></div><div><a href="/2023/06/04/2023-6-4_2.4calculus/" title="2.4 calculus with pytorch"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-04</div><div class="title">2.4 calculus with pytorch</div></div></a></div><div><a href="/2023/07/01/2023-7-1_3.3%20Brief%20realization%20of%20linear%20regression/" title="3.3 线性回归的简洁实现"><img class="cover" src="https://images.pexels.com/photos/1903702/pexels-photo-1903702.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-01</div><div class="title">3.3 线性回归的简洁实现</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-2-%E5%90%91%E9%87%8F%E5%8C%96%E5%8A%A0%E9%80%9F"><span class="toc-number">1.</span> <span class="toc-text">3.1.2 向量化加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-3-normal-distribution-and-square-loss"><span class="toc-number">2.</span> <span class="toc-text">3.1.3 normal distribution and square loss</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-linear-regression-from-zero"><span class="toc-number">3.</span> <span class="toc-text">3.2 linear regression from zero</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-2-read-the-dataset"><span class="toc-number">4.</span> <span class="toc-text">3.2.2 read the dataset</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-3-Initialize-model-parameters"><span class="toc-number">5.</span> <span class="toc-text">3.2.3 Initialize model parameters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-4-define-model"><span class="toc-number">6.</span> <span class="toc-text">3.2.4 define model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-5-define-loss-function"><span class="toc-number">7.</span> <span class="toc-text">3.2.5 define loss function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-6-define-optimization-algorithm"><span class="toc-number">8.</span> <span class="toc-text">3.2.6 define optimization algorithm</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://images.pexels.com/photos/1509534/pexels-photo-1509534.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Spencer</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="Chat"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://www.mathming.ltd/2023/06/06/2023-6-6_3.1%20Linear%20regression/'
    this.page.identifier = '/2023/06/06/2023-6-6_3.1%20Linear%20regression/'
    this.page.title = '3.1 Linear regression'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><a href="https://beian.miit.gov.cn/" target="_blank" class="is-center">冀ICP备2021024675号-1</a><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>