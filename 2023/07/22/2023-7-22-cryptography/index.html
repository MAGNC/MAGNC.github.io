<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>cryptography | Spencer</title><meta name="author" content="Spencer"><meta name="copyright" content="Spencer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="我们平时的key, cer等等密钥文件，打开时并不是我们喜欢的n,p,q的公私钥形式，而是已经编码好的形式，而编码的规则就是基于X.690标准中的ASN.1的编码格式：Basic Encoding Rules(BER), Canonical Encoding Rules(CER), Distingu"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.mathming.ltd/2023/07/22/2023-7-22-cryptography/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-NFDHX1L800"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NFDHX1L800');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":10,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: Spencer","link":"Link: ","source":"Source: Spencer","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'cryptography',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-24 11:16:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">159</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">60</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">36</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-gallery"></i><span> Gallery</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Spencer</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-gallery"></i><span> Gallery</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">cryptography</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-07-21T16:00:00.000Z" title="Created 2023-07-22 00:00:00">2023-07-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-08-24T03:16:18.293Z" title="Updated 2023-08-24 11:16:18">2023-08-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="cryptography"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>我们平时的key, cer等等密钥文件，打开时并不是我们喜欢的n,p,q的公私钥形式，而是已经编码好的形式，而编码的规则就是基于X.690标准中的ASN.1的编码格式：Basic Encoding Rules(BER), Canonical Encoding Rules(CER), Distinguished Encoding Rules(DER).</p>
<p>The BER were origin rules laid out by the ASN.1 standard for <strong>encoding data into a binary format.</strong>The rules used octets(8bit bytes) to encode data.</p>
<p><strong>X.680 defines a syntax for declaring data types</strong>, for example: booleans, numbers, strings and compound structures. Each type definition also includes an identifying number. </p>
<p>X.680 defined several <strong>primitive data types, like BooleanType, IntegerType, OctetStringType</strong>. Types are associated with a class. For example, the <strong>primitive types are part of the universal class.</strong> There are other classes, including application, private and context-specific, which are used to specific applications.</p>
<p>Conbined, <strong>the class and type from a tag, which therefore corresponds to a unique data definition</strong>. X.690 rules are for encoding those tags, data values, and the lengths of that encoded data.</p>
<h2 id="BER-encoding"><a href="#BER-encoding" class="headerlink" title="BER encoding"></a>BER encoding</h2><p><img src="/2023/07/22/2023-7-22-cryptography/image-20230822012505668.png" alt="image-20230822012505668"></p>
<p>This is the structure of BER encoding including three or four components. Note that if a Length is zero, namely there are no Contents octets, e.g. the NULL type. <strong>The End-of-Contents octets are only used for the indefinite form of Length.</strong></p>
<h2 id="openssl"><a href="#openssl" class="headerlink" title="openssl"></a>openssl</h2><p>This note is from the book \<openssl cookbook\>.</openssl></p>
<p>If we want to check the version of openssl, because sometimes a wrong version will cause the error.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl version -a</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/22/2023-7-22-cryptography/image-20230822021244702.png" alt="image-20230822021244702"></p>
<p>you will find how your OpenSSL was compiled and where is the <strong>OPENSSLDIR, which tells you where OpenSSL looks for its default configuration and root certificates.</strong></p>
<h3 id="building-OpenSSL"><a href="#building-OpenSSL" class="headerlink" title="building OpenSSL"></a>building OpenSSL</h3><p>we can download it and build it by ourselves</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> ./config \</span><br><span class="line">--prefix=/opt/openssl \</span><br><span class="line">--openssldir=/opt/openssl \</span><br><span class="line">no-shared \</span><br><span class="line">-DOPENSSL_TLS_SECURITY_LEVEL=2 \</span><br><span class="line">enable-ec_nistp_64_gcc_128</span><br></pre></td></tr></table></figure>
<p><strong>—prefix</strong> makes sure to install OpenSSL to a private location that doesn’t clash with the system-provided version.</p>
<p>The other important option is <strong>no-shared</strong>, which doesn’t use static linking and makes self-contained command-line tools.</p>
<p>then we can build</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make test</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>we can use ‘man’ to learn specific utility.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man openssl-ciphers# will give you detailed information on how cipher suites are configured.</span><br></pre></td></tr></table></figure>
<p>or </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man openssl-enc</span><br></pre></td></tr></table></figure>
<h3 id="Build-a-trust-store"><a href="#Build-a-trust-store" class="headerlink" title="Build a trust store"></a>Build a trust store</h3><p>The trust store is a collection of trusted root certificates.OpenSSL doens’t come with a trust store, so you can use it built into your operating system.</p>
<p>In ubuntu, you can use <code>update-ca-certificates</code> to replace the contents of the <code>/etc/ssl/certs</code></p>
<p>Mozila put a lot of effort to maintaining a transparent and up-to-date root store for use in Firefox. It is opensource</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hg.mozilla.org/releases/mozilla-beta/file/tip/security/nss/lib/ckfw/builtins/certdata.txt</span><br></pre></td></tr></table></figure>
<p>Unfortunately its certificate collection is in a proprietary format, which is not of much use to others as is. To convert Mozila’s root store, we download</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://raw.githubusercontent.com/curl/curl/master/scripts/mk-ca-bundle.pl</span><br></pre></td></tr></table></figure>
<p>it will fetch the certificate data from Mozilla and convert it into the PEM format.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mk-ca-bundle.pl</span><br></pre></td></tr></table></figure>
<h2 id="key-and-Certificate-Management"><a href="#key-and-Certificate-Management" class="headerlink" title="key and Certificate Management"></a>key and Certificate Management</h2><p>Users wish to configure and run a web server that supports SSL. That process consists of three steps: </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(1)generate a private key</span><br><span class="line">(2)create a Certificate Signing Request(CSR) and sent it to a CA.</span><br><span class="line">(3)install the CA-provided certificate in your web server.</span><br></pre></td></tr></table></figure>
<h3 id="Key-Generation"><a href="#Key-Generation" class="headerlink" title="Key Generation"></a>Key Generation</h3><p><strong>key algorithm</strong>: we usually use RSA and ECDSA in our certificates.</p>
<p><strong>key size:</strong> the default for RSA keys used to be 512 bits,which is insecure. Today, 2048-bit RSA are considered secure, or 256 bits for ECDSA.</p>
<p><strong>Passphrase</strong>: using a passphrase with a key is optional, but recommended</p>
<p>To generate an RSA key, we use genpkey</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl genpkey -out fd.key \ </span><br><span class="line">-algorithm RSA \</span><br><span class="line">-pkeyout rsa_keygen_bits:2048 \</span><br><span class="line">-aes-128-cbc</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">then</span> run this and <span class="keyword">then</span> input our passphrase <span class="keyword">for</span> the key.</span></span><br></pre></td></tr></table></figure>
<p>Here I specific that the key be protected with AES-128. You can also use AES-256(with -aes-256-cbc)</p>
<p><strong>Note: By default, OpenSSL will set the public exponent of new rsa to 65537.</strong></p>
<p>When we use the genpkey command, the generated private keys are stored in PKCS #8 format, which is jest text</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat fd.key</span><br></pre></td></tr></table></figure>
<p>and if we want to see the detailed data like n and e in the private key, the command can be</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkey -in fd.key -text -noout</span><br></pre></td></tr></table></figure>
<p>the the datas will be exhibited.</p>
<p>If you only want to have the public part of a key, the command can be</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkey -in fd.key -pubout -out fd-public.key</span><br></pre></td></tr></table></figure>
<p>The process is similar for ECDSA keys</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> openssl genpkey -out fd.key \</span><br><span class="line">-algorithm EC \</span><br><span class="line">-pkeyopt ec_paramgen_curve:P-256 \</span><br><span class="line">-aes-128-cbc</span><br></pre></td></tr></table></figure>
<p>for web server keys, you are generally limited to only two curves that are widely supported: P-256 and P-384.</p>
<p>The recent additions ed25519 and so on are also supported, but they are different types of curves and have to be specified using the -algorithm switch</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genpkey -algorithm ed25519</span><br></pre></td></tr></table></figure>
<h2 id="python-cryptography-algorigthm"><a href="#python-cryptography-algorigthm" class="headerlink" title="python cryptography algorigthm"></a>python cryptography algorigthm</h2><p><strong>note: Contents are from my accumulating writeups of many CTF competitions.</strong></p>
<h3 id="hex-replacement-bruce"><a href="#hex-replacement-bruce" class="headerlink" title="hex replacement bruce"></a>hex replacement bruce</h3><p>This is a easy rsa that some letters of the p are substituted in terms of ‘FC’, the ‘FC’ may be the same in the previous p, and also can be ‘9F’ in the previous p.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">p_inil = <span class="string">&quot;DCC5A0BD3A1FC0BEB0DA1C2E8CF6B474481B7C12849B76E03C4C946724DB577D2825D6AA193DB559BC9DBABE1DDE8B5E7805E48749EF002F622F7CDBD7853B200E2A027E87E331AFCFD066ED9900F1E5F5E5196A451A6F9E329EB889D773F08E5FBF45AACB818FD186DD74626180294DCC31805A88D1B71DE5BFEF3ED01F12678D906A833A78EDCE9BDAF22BBE45C0BFB7A82AFE42C1C3B8581C83BF43DFE31BFD81527E507686956458905CC9A660604552A060109DC81D01F229A264AB67C6D7168721AB36DE769CEAFB97F238050193EC942078DDF5329A387F46253A4411A9C8BB71F9AEB11AC9623E41C14FCD2739D76E69283E57DDB11FC531B4611EE3&quot;</span></span><br><span class="line">n = <span class="number">719579745653303119025873098043848913976880838286635817351790189702008424828505522253331968992725441130409959387942238566082746772468987336980704680915524591881919460709921709513741059003955050088052599067720107149755856317364317707629467090624585752920523062378696431510814381603360130752588995217840721808871896469275562085215852034302374902524921137398710508865248881286824902780186249148613287250056380811479959269915786545911048030947364841177976623684660771594747297272818410589981294227084173316280447729440036251406684111603371364957690353449585185893322538541593242187738587675489180722498945337715511212885934126635221601469699184812336984707723198731876940991485904637481371763302337637617744175461566445514603405016576604569057507997291470369704260553992902776099599438704680775883984720946337235834374667842758010444010254965664863296455406931885650448386682827401907759661117637294838753325610213809162253020362015045242003388829769019579522792182295457962911430276020610658073659629786668639126004851910536565721128484604554703970965744790413684836096724064390486888113608024265771815004188203124405817878645103282802994701531113849607969243815078720289912255827700390198089699808626116357304202660642601149742427766381</span></span><br><span class="line"></span><br><span class="line">ps = p_inil.split(<span class="string">&#x27;FC&#x27;</span>)<span class="comment">#以fc分成5段，说明有4个FC,四个位置用所有可能去爆破</span></span><br><span class="line">np = <span class="string">&quot;&quot;</span></span><br><span class="line">np1 = <span class="number">0</span></span><br><span class="line">p = <span class="number">0</span></span><br><span class="line">a = [<span class="string">&#x27;9F&#x27;</span>, <span class="string">&#x27;FC&#x27;</span>]</span><br><span class="line">b = <span class="number">4</span></span><br><span class="line">sets = [<span class="string">&#x27;&#x27;</span>.join(x) <span class="keyword">for</span> x <span class="keyword">in</span> itertools.product(*[a] * b)]<span class="comment">#也就是产生共16种情况</span></span><br><span class="line"><span class="comment">#格式如下</span></span><br><span class="line"><span class="comment">#[&#x27;9FFCFC9F&#x27;, &#x27;FCFC9F9F&#x27;, ...一共16种]</span></span><br><span class="line"><span class="comment">#开始爆破...00</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):<span class="comment">#0-15,共16种情况</span></span><br><span class="line">    np = ps[<span class="number">0</span>] + sets[j][<span class="number">0</span>:<span class="number">2</span>] + ps[<span class="number">1</span>] + sets[j][<span class="number">2</span>:<span class="number">4</span>] + ps[<span class="number">2</span>] + sets[j][<span class="number">4</span>:<span class="number">6</span>] + ps[<span class="number">3</span>] + sets[j][<span class="number">6</span>:<span class="number">8</span>] + ps[<span class="number">4</span>]</span><br><span class="line">    np1 = <span class="built_in">int</span>(np, <span class="number">16</span>)<span class="comment">#进行数据类型转换</span></span><br><span class="line">    <span class="keyword">if</span> n % np1 == <span class="number">0</span>:</span><br><span class="line">        p = np1</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">q = n // p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = invert(<span class="number">65537</span>, phi)</span><br><span class="line">c = <span class="number">596380963583874022971492302071822444225514552231574984926542429117396590795270181084030717066220888052607057994262255729890598322976783889090993129161030148064314476199052180347747135088933481343974996843632511300255010825580875930722684714290535684951679115573751200980708359500292172387447570080875531002842462002727646367063816531958020271149645805755077133231395881833164790825731218786554806777097126212126561056170733032553159740167058242065879953688453169613384659653035659118823444582576657499974059388261153064772228570460351169216103620379299362366574826080703907036316546232196313193923841110510170689800892941998845140534954264505413254429240789223724066502818922164419890197058252325607667959185100118251170368909192832882776642565026481260424714348087206462283972676596101498123547647078981435969530082351104111747783346230914935599764345176602456069568419879060577771404946743580809330315332836749661503035076868102720709045692483171306425207758972682717326821412843569770615848397477633761506670219845039890098105484693890695897858251238713238301401843678654564558196040100908796513657968507381392735855990706254646471937809011610992016368630851454275478216664521360246605400986428230407975530880206404171034278692756</span></span><br><span class="line">m = long_to_bytes(<span class="built_in">pow</span>(c, d, n))</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>
<p>Apparently the Crypto library and itertools library are very important. The itertools.product can produce all the possible combinations of the tuples.</p>
<h3 id="AES-decode"><a href="#AES-decode" class="headerlink" title="AES decode"></a>AES decode</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">repeat = long_to_bytes(<span class="number">91144196586662942563895769614300232343026691029427747065707381728622849079757</span>)</span><br><span class="line"><span class="built_in">print</span>(repeat)</span><br><span class="line">key_single = <span class="string">b&#x27;\xc9\x81&#x27;</span> * <span class="number">16</span></span><br><span class="line">iv = bytes_to_long(key_single) ^ bytes_to_long(repeat)</span><br><span class="line">iv = long_to_bytes(iv)</span><br><span class="line">cipher = AES.new(key_single, AES.MODE_CBC, iv)</span><br><span class="line">m = cipher.decrypt(</span><br><span class="line">    <span class="string">b&#x27;\x8c-\xcd\xde\xa7\xe9\x7f.b\x8aKs\xf1\xba\xc75\xc4d\x13\x07\xac\xa4&amp;\xd6\x91\xfe\xf3\x14\x10|\xf8p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>
<p>So this is an AES cryptography problem, firstly we introduce AES cryptography.</p>
<h2 id="AES-algorithm"><a href="#AES-algorithm" class="headerlink" title="AES algorithm"></a>AES algorithm</h2><p>The properties are:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The size of grouping is 128-bit.</span><br><span class="line"></span><br><span class="line">It must support three cipher standards:128-bit, 192-bit and 256-bit</span><br><span class="line"></span><br><span class="line">It is more safe and efficiency in both hardware and software.</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/22/2023-7-22-cryptography/v2-8ac292e26e80562209eeffe03584e31d_1440w.png" alt="img"></p>
<p>This is a introduction graph.</p>
<p>There are mainly four operations in AES algorithm, <strong>Add Round Key(轮密钥加), SubByte(字节代换), Shift Rows(行位移层), column mix(列混淆层).</strong> <strong>The plaintext x and the secret key k are both 16-Byte data.</strong></p>
<p>The law of the order of the data is like below graph.</p>
<p><img src="/2023/07/22/2023-7-22-cryptography/v2-fe04b0967fd0a6581b083e42a47a546c_1440w.png" alt="img"></p>
<p>And <strong>the ciphertext has the same reading method as above</strong>, namely obtaining a string sequence from a matrix with numbers.</p>
<p>Now looking at the principle graph of AES algorithm.</p>
<p><img src="/2023/07/22/2023-7-22-cryptography/v2-b22e3bdd7da5ddf5ea6ff71909dac4b7_1440w.png" alt="img"></p>
<p>We can see that in the part of <strong>Add Round Key, there are two input parameters</strong>, the <strong>plaintext and sub secret key k[0].</strong></p>
<p>In fact the k[0] is equal to k, we will explain the reason in the secret generating. </p>
<p>We just XOR the plaintext x and k[0], like the graph below.</p>
<p><img src="/2023/07/22/2023-7-22-cryptography/v2-cab03da551aafad821676824c1bc6ebe_1440w.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">AddRoundKey</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>(* PlainArray)[<span class="number">4</span>], <span class="type">unsigned</span> <span class="type">char</span>(*ExtendKeyArray)[<span class="number">44</span>], <span class="type">unsigned</span> <span class="type">int</span> MinColumn)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            PlainArray[i][j] ^= ExtendKeyArray[i][MinColumn + j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we look at SubByte layer, which <strong>maps each byte of input data to another byte by S_box.</strong></p>
<p>The method of calculating the S_box will be introduced in the latter part, so now we assume it has been calculated.</p>
<p><strong>S_box is an array with 256 elements namely 16 by 16 and the form of the element is  byte.</strong></p>
<p>If we define the S_box as a two-dimension array, then reading this array should regard the higher four bits as the first index, and the lower four bits as the second index, namely 4bit=16 and 16x16=256 elements!</p>
<p><strong>Inverse S_box</strong> corresponding to S_box, which is used to process the data when decoding the data, called <strong>inverse byte substitution.</strong> </p>
<p><strong>S_box</strong></p>
<p><img src="/2023/07/22/2023-7-22-cryptography/v2-e160744c78b680b008c165cb78841858_1440w.webp" alt="img"></p>
<p><strong>inverse S_box</strong></p>
<p><img src="/2023/07/22/2023-7-22-cryptography/v2-11d806427bd01e1f3c267504e56b3841_1440w.png" alt="img"></p>
<h3 id="The-process-of-SubByte"><a href="#The-process-of-SubByte" class="headerlink" title="The process of SubByte"></a>The process of SubByte</h3><p><img src="/2023/07/22/2023-7-22-cryptography/v2-83b41eb29d3e797bafdc4d669365bf5c_1440w.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//S_box</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> S_Table[<span class="number">16</span>][<span class="number">16</span>] = &#123;<span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">                                       <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">                                       <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">                                       <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">                                       <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">                                       <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">                                       <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">                                       <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">                                       <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">                                       <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">                                       <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">                                       <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">                                       <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">                                       <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">                                       <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">                                       <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Plain_S_Substitution</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *PlainArray)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        PlainArray[i] = S_Table[PlainArray[i] &gt;&gt; <span class="number">0b10</span>][PlainArray[i] &amp; <span class="number">0x0f</span>];<span class="comment">//也就是用了二维索引，所以按照明文去索引，将明文元素逐个替换！</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//inverse S_box</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> Inverse_S_Table[<span class="number">16</span>][<span class="number">16</span>] = &#123;<span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6A</span>, <span class="number">0xD5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xA5</span>, <span class="number">0x38</span>, <span class="number">0xBF</span>, <span class="number">0x40</span>, <span class="number">0xA3</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0xD7</span>, <span class="number">0xFB</span>,</span><br><span class="line">                                               <span class="number">0x7C</span>, <span class="number">0xE3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8E</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xC4</span>, <span class="number">0xDE</span>, <span class="number">0xE9</span>, <span class="number">0xCB</span>,</span><br><span class="line">                                               <span class="number">0x54</span>, <span class="number">0x7B</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0xEE</span>, <span class="number">0x4C</span>, <span class="number">0x95</span>, <span class="number">0x0B</span>, <span class="number">0x42</span>, <span class="number">0xFA</span>, <span class="number">0xC3</span>, <span class="number">0x4E</span>,</span><br><span class="line">                                               <span class="number">0x08</span>, <span class="number">0x2E</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xD9</span>, <span class="number">0x24</span>, <span class="number">0xB2</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0xA2</span>, <span class="number">0x49</span>, <span class="number">0x6D</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0x25</span>,</span><br><span class="line">                                               <span class="number">0x72</span>, <span class="number">0xF8</span>, <span class="number">0xF6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xD4</span>, <span class="number">0xA4</span>, <span class="number">0x5C</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, <span class="number">0x65</span>, <span class="number">0xB6</span>, <span class="number">0x92</span>,</span><br><span class="line">                                               <span class="number">0x6C</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xFD</span>, <span class="number">0xED</span>, <span class="number">0xB9</span>, <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x9D</span>, <span class="number">0x84</span>,</span><br><span class="line">                                               <span class="number">0x90</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x00</span>, <span class="number">0x8C</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0x0A</span>, <span class="number">0xF7</span>, <span class="number">0xE4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">                                               <span class="number">0xD0</span>, <span class="number">0x2C</span>, <span class="number">0x1E</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x3F</span>, <span class="number">0x0F</span>, <span class="number">0x02</span>, <span class="number">0xC1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8A</span>, <span class="number">0x6B</span>,</span><br><span class="line">                                               <span class="number">0x3A</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x67</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, <span class="number">0x97</span>, <span class="number">0xF2</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xB4</span>, <span class="number">0xE6</span>, <span class="number">0x73</span>,</span><br><span class="line">                                               <span class="number">0x96</span>, <span class="number">0xAC</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xE7</span>, <span class="number">0xAD</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x37</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x75</span>, <span class="number">0xDF</span>, <span class="number">0x6E</span>,</span><br><span class="line">                                               <span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0x1A</span>, <span class="number">0x71</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0xC5</span>, <span class="number">0x89</span>, <span class="number">0x6F</span>, <span class="number">0xB7</span>, <span class="number">0x62</span>, <span class="number">0x0E</span>, <span class="number">0xAA</span>, <span class="number">0x18</span>, <span class="number">0xBE</span>, <span class="number">0x1B</span>,</span><br><span class="line">                                               <span class="number">0xFC</span>, <span class="number">0x56</span>, <span class="number">0x3E</span>, <span class="number">0x4B</span>, <span class="number">0xC6</span>, <span class="number">0xD2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9A</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xFE</span>, <span class="number">0x78</span>, <span class="number">0xCD</span>, <span class="number">0x5A</span>, <span class="number">0xF4</span>,</span><br><span class="line">                                               <span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0xA8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>, <span class="number">0x31</span>, <span class="number">0xB1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>,</span><br><span class="line">                                               <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7F</span>, <span class="number">0xA9</span>, <span class="number">0x19</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0x0D</span>, <span class="number">0x2D</span>, <span class="number">0xE5</span>, <span class="number">0x7A</span>, <span class="number">0x9F</span>, <span class="number">0x93</span>, <span class="number">0xC9</span>, <span class="number">0x9C</span>, <span class="number">0xEF</span>,</span><br><span class="line">                                               <span class="number">0xA0</span>, <span class="number">0xE0</span>, <span class="number">0x3B</span>, <span class="number">0x4D</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xF5</span>, <span class="number">0xB0</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xBB</span>, <span class="number">0x3C</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">                                               <span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x04</span>, <span class="number">0x7E</span>, <span class="number">0xBA</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0x26</span>, <span class="number">0xE1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0C</span>, <span class="number">0x7D</span>&#125;;</span><br><span class="line"><span class="comment">//inverse byte substitution</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">Cipher_S_Substitution</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *CipherArray)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        CipherArray[i] = Inverse_S_Table[CipherArray[i] &gt;&gt; <span class="number">0b10</span>][CipherArray[i] &amp; <span class="number">0x0f</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="The-ShiftRows-is-just-a-matrix-performance"><a href="#The-ShiftRows-is-just-a-matrix-performance" class="headerlink" title="The ShiftRows is just a matrix performance:"></a>The ShiftRows is just a matrix performance:</h3><p><img src="/2023/07/22/2023-7-22-cryptography/v2-581b444c6583aff31afe66b0391d73c1_1440w.png" alt="img"></p>
<p>We remain the first row, then the second row is moved one-bit left, and the third row is moved two-bit left, similar to the last row.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ShiftRows</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *PlainArray)</span><span class="comment">//This way we use the one-dimension array</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//the first row</span></span><br><span class="line">    PlainArray[<span class="number">0</span>] = PlainArray[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//the second row</span></span><br><span class="line">    PlainArray[<span class="number">1</span>] = (PlainArray[<span class="number">1</span>] &gt;&gt; <span class="number">8</span>) | (PlainArray[<span class="number">1</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">    <span class="comment">//虽然写的是左移8bit，但是注意，在数组中左移相当于在地址中左移，然而小端存储中读取数从地址小到地址大，所以数组中左移相当于把地址缩小了</span></span><br><span class="line">    <span class="comment">//然而我们要实现的效果是让地址变大，所以说实际上是右移，那么逆变换同理！</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//the third row</span></span><br><span class="line">    PlainArray[<span class="number">2</span>] = (PlainArray[<span class="number">2</span>] &gt;&gt; <span class="number">16</span>) | (PlainArray[<span class="number">2</span>] &lt;&lt; <span class="number">16</span>);<span class="comment">//or</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//the fourth row</span></span><br><span class="line">    PlainArray[<span class="number">3</span>] = (PlainArray[<span class="number">3</span>] &gt;&gt; <span class="number">24</span>) | (PlainArray[<span class="number">3</span>] &lt;&lt; <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ReShiftRows</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *PlainArray)</span><span class="comment">//This way we use the one-dimension array</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//the first row</span></span><br><span class="line">    PlainArray[<span class="number">0</span>] = PlainArray[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//the second row</span></span><br><span class="line">    PlainArray[<span class="number">1</span>] = (PlainArray[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | (PlainArray[<span class="number">1</span>] &gt;&gt; <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//the third row</span></span><br><span class="line">    PlainArray[<span class="number">2</span>] = (PlainArray[<span class="number">2</span>] &lt;&lt; <span class="number">16</span>) | (PlainArray[<span class="number">2</span>] &gt;&gt; <span class="number">16</span>);<span class="comment">//or</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//the fourth row</span></span><br><span class="line">    PlainArray[<span class="number">3</span>] = (PlainArray[<span class="number">3</span>] &lt;&lt; <span class="number">24</span>) | (PlainArray[<span class="number">3</span>] &gt;&gt; <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/22/2023-7-22-cryptography/lbwp9hbphi.jpeg" alt="img"></p>
<p>Now that we have the ShiftRows in the Encoding process, we also have Reverse ShiftRow in the Decoding process.</p>
<p><img src="/2023/07/22/2023-7-22-cryptography/v2-d90578c8b7a5942cc18bc2f1d0618b76_1440w-20230823024924793.png" alt="img"></p>
<p>And the code is exhibited above.</p>
<h3 id="Mix-Column-每一列乘状态矩阵，替换原来的列"><a href="#Mix-Column-每一列乘状态矩阵，替换原来的列" class="headerlink" title="Mix Column(每一列乘状态矩阵，替换原来的列)"></a>Mix Column(每一列乘状态矩阵，替换原来的列)</h3><p>It will mix each column of input matrix, which enables <strong>each input byte to impact four output bytes.</strong></p>
<p>In the forward column mixtion, we use a 4 by 4 fixed matrix left multiply the input matrix. However their addition, multiplication will run in the field of GF(2^8).</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">MixColum</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>(*PlainArray) [<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ArrayTemp[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="built_in">memcpy</span>(ArrayTemp, PlainArray, <span class="number">16</span>);<span class="comment">//从PlainArray中拷贝到ArrayTemp</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//matmul</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            PlainArray[i][j] =</span><br><span class="line">                    GaloisMultiplication(MixArray[i][<span class="number">0</span>], ArrayTemp[<span class="number">0</span>][j]) ^</span><br><span class="line">                    GaloisMultiplication(MixArray[i][<span class="number">1</span>], ArrayTemp[<span class="number">1</span>][j]) ^</span><br><span class="line">                    GaloisMultiplication(MixArray[i][<span class="number">2</span>], ArrayTemp[<span class="number">2</span>][j]) ^</span><br><span class="line">                    GaloisMultiplication(MixArray[i][<span class="number">3</span>], ArrayTemp[<span class="number">3</span>][j]);</span><br><span class="line"><span class="comment">//            PlainArray[i][j] =</span></span><br><span class="line"><span class="comment">//                    MixArray[i][0] * ArrayTemp[0][j] +</span></span><br><span class="line"><span class="comment">//                    MixArray[i][1] * ArrayTemp[1][j] +</span></span><br><span class="line"><span class="comment">//                    MixArray[i][2] * ArrayTemp[2][j] +</span></span><br><span class="line"><span class="comment">//                    MixArray[i][3] * ArrayTemp[3][j];//注意，我们要用异或，而不是加法，所以不能这样定义函数</span></span><br><span class="line">        &#125;<span class="comment">//最后的乘积改变原来的明文。</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> <span class="title function_">GaloisMultiplication</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> Num_L, <span class="type">unsigned</span> <span class="type">char</span> Num_R)</span><span class="comment">//left parameter and right parameter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//define variable;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> Result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(Num_L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//如果Num_L最低位是1就是异或Num_R, 相当于加上Num_R * 1</span></span><br><span class="line">        <span class="keyword">if</span>(Num_L &amp; <span class="number">0x01</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Result ^= Num_R;<span class="comment">//相当于Num_R乘上左操作数的最后一位，加上去，也就是乘法的过程！</span></span><br><span class="line">        &#125;</span><br><span class="line">        Num_L = Num_L &gt;&gt; <span class="number">1</span>;<span class="comment">//右移一位，相当于除以二</span></span><br><span class="line">        <span class="keyword">if</span>(Num_R &amp; <span class="number">0x80</span>)<span class="comment">//Num_R最高位1的话，左移一位就会溢出，所以乘2后进行除法运算</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//左移一位，也就是乘2</span></span><br><span class="line">            Num_R = Num_R &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            Num_R ^= <span class="number">0x1B</span>;<span class="comment">//计算Galois除法Num_R = Num_R / (x^8(刚好丢失最高位) + x^4 + x^3 + x^1 + 1)0x00011011	</span></span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Num_R = Num_R &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the decoding process, we just use the inverse matrix.</p>
<p><strong>Note: we should finally transform the ciphertext from bytes matrix to strings!</strong></p>
<h3 id="AES-secret-key"><a href="#AES-secret-key" class="headerlink" title="AES secret key"></a>AES secret key</h3><p><img src="/2023/07/22/2023-7-22-cryptography/v2-3027156eb00bcddcdac69657c8aad1e7_1440w.webp" alt="img"></p>
<p>The column of subkey matrix can be regarded as the element. One column has 32 bits, so the four are totally 128bits.</p>
<p>The number of generated subkeys are one more than the turns of AES.</p>
<p><strong>Key schedule is to expand the secret key to 10 secret keys namely 40 columns!</strong></p>
<p>Look at the picture above! When we reach the w[0], w[4], w[8] and all w[i] and i can be divided by 4, we should use g(x) to process w[0], w[4]….. Look at the picture about on the right. </p>
<p><strong>If we wanna get w[4]!</strong></p>
<p>We write w[3] as a row, and then put the B1 into the tailer, we make B2, B3, B4 move forward. Finally we use S_box to map each B. <strong>and then add a round constant Rcon to the first number of transformed w to obtain w’.</strong></p>
<p>Finally XOR the w’ (from w3) and W0 to get the w4!</p>
<p><strong>If we wanna get w[5](namely i cannot be divided by 4)</strong></p>
<p>Just XOR the w[i-1] and w[i-4]!</p>
<p>Repeat the above process to get 10 groups Round keys.</p>
<h3 id="generate-the-ciphertext"><a href="#generate-the-ciphertext" class="headerlink" title="generate the ciphertext"></a>generate the ciphertext</h3><p>We use <strong>Round key to XOR our plaintext matrix column by column!</strong></p>
<p>And we repeat 10 times in AES-128, 12 times for AES-192, 14 times for AES-256</p>
<p><img src="/2023/07/22/2023-7-22-cryptography/image-20230824110838200.png" alt="image-20230824110838200"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">Key_S_Substitution</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>(*ExtendKeyArray)[<span class="number">44</span>], <span class="type">unsigned</span> <span class="type">int</span> nCol)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ExtendKeyArray[i][nCol] = S_Table[(ExtendKeyArray[i][nCol]) &gt;&gt; <span class="number">4</span>][(ExtendKeyArray[i][nCol]) &amp; <span class="number">0x0F</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">G_Function</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>(*ExtendKeyArray)[<span class="number">44</span>], <span class="type">unsigned</span> <span class="type">int</span> nCol)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1、将扩展密钥矩阵的nCol-1列复制到nCol列上，并将nCol列第一行的元素移动到最后一行，其他行数上移一行</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ExtendKeyArray[i][nCol] = ExtendKeyArray[(i + <span class="number">1</span>) % <span class="number">4</span>][nCol - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、将nCol列进行S盒替换</span></span><br><span class="line">    Key_S_Substitution(ExtendKeyArray, nCol);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3、将该列第一行元素与Rcon进行异或运算</span></span><br><span class="line">    ExtendKeyArray[<span class="number">0</span>][nCol] ^= Rcon[nCol / <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">CalculateExtendKeyArray</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>(*PasswordArray)[<span class="number">4</span>], <span class="type">unsigned</span> <span class="type">char</span>(*ExtendKeyArray)[<span class="number">44</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1、将密钥数组放入前四列扩展密钥组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ExtendKeyArray[i &amp; <span class="number">0x03</span>][i &gt;&gt; <span class="number">2</span>] = PasswordArray[i &amp; <span class="number">0x03</span>][i &gt;&gt; <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、计算扩展矩阵的后四十列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">11</span>; i++) <span class="comment">//进行十轮循环</span></span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//(1)如果列号是4的倍数，这执行G函数 否则将nCol-1列复制到nCol列上</span></span><br><span class="line">        G_Function(ExtendKeyArray, <span class="number">4</span>*i);</span><br><span class="line"></span><br><span class="line"><span class="comment">//(2)每一轮中，各列进行异或运算</span></span><br><span class="line"><span class="comment">// 列号是4的倍数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++)<span class="comment">//行号</span></span><br><span class="line">        &#123;</span><br><span class="line">            ExtendKeyArray[k][<span class="number">4</span> * i] = ExtendKeyArray[k][<span class="number">4</span> * i] ^ ExtendKeyArray[k][<span class="number">4</span> * (i - <span class="number">1</span>)];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他三列</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="number">4</span>; j++)<span class="comment">//每一轮的列号</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++)<span class="comment">//行号</span></span><br><span class="line">            &#123;</span><br><span class="line">                ExtendKeyArray[k][<span class="number">4</span> * i + j] = ExtendKeyArray[k][<span class="number">4</span> * i + j - <span class="number">1</span>] ^ ExtendKeyArray[k][<span class="number">4</span> * (i - <span class="number">1</span>) + j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="When-in-the-decoding-course"><a href="#When-in-the-decoding-course" class="headerlink" title="When in the decoding course"></a>When in the decoding course</h3><p>We just subtitude the S_box to inverse_S_box, Shift Rows to Inverse Shift Rows, Mix Columns to Inverse Mix Columns!</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://www.mathming.ltd">Spencer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://www.mathming.ltd/2023/07/22/2023-7-22-cryptography/">http://www.mathming.ltd/2023/07/22/2023-7-22-cryptography/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cryptography/">cryptography</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/25/2023-7-25-KNN-algorithm/"><img class="prev-cover" src="https://images.pexels.com/photos/1903702/pexels-photo-1903702.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">KNN algorithm</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/21/4.4%20model%20choosing,%20underfitting%20and%20overfitting/"><img class="next-cover" src="https://images.pexels.com/photos/1903702/pexels-photo-1903702.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">4.4 model choosing, underfitting and overfitting</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/10/29/2023-10-29-%E7%AE%80%E5%8D%95%E7%A7%BB%E4%BD%8D%E5%AF%86%E7%A0%81%E7%9A%84HLS%E5%AE%9E%E7%8E%B0/" title="简单移位密码的HLS实现"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-29</div><div class="title">简单移位密码的HLS实现</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#BER-encoding"><span class="toc-number">1.</span> <span class="toc-text">BER encoding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#openssl"><span class="toc-number">2.</span> <span class="toc-text">openssl</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#building-OpenSSL"><span class="toc-number">2.1.</span> <span class="toc-text">building OpenSSL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Build-a-trust-store"><span class="toc-number">2.2.</span> <span class="toc-text">Build a trust store</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#key-and-Certificate-Management"><span class="toc-number">3.</span> <span class="toc-text">key and Certificate Management</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Generation"><span class="toc-number">3.1.</span> <span class="toc-text">Key Generation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python-cryptography-algorigthm"><span class="toc-number">4.</span> <span class="toc-text">python cryptography algorigthm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hex-replacement-bruce"><span class="toc-number">4.1.</span> <span class="toc-text">hex replacement bruce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AES-decode"><span class="toc-number">4.2.</span> <span class="toc-text">AES decode</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AES-algorithm"><span class="toc-number">5.</span> <span class="toc-text">AES algorithm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-process-of-SubByte"><span class="toc-number">5.1.</span> <span class="toc-text">The process of SubByte</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-ShiftRows-is-just-a-matrix-performance"><span class="toc-number">5.2.</span> <span class="toc-text">The ShiftRows is just a matrix performance:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mix-Column-%E6%AF%8F%E4%B8%80%E5%88%97%E4%B9%98%E7%8A%B6%E6%80%81%E7%9F%A9%E9%98%B5%EF%BC%8C%E6%9B%BF%E6%8D%A2%E5%8E%9F%E6%9D%A5%E7%9A%84%E5%88%97"><span class="toc-number">5.3.</span> <span class="toc-text">Mix Column(每一列乘状态矩阵，替换原来的列)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AES-secret-key"><span class="toc-number">5.4.</span> <span class="toc-text">AES secret key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#generate-the-ciphertext"><span class="toc-number">5.5.</span> <span class="toc-text">generate the ciphertext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#When-in-the-decoding-course"><span class="toc-number">5.6.</span> <span class="toc-text">When in the decoding course</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Spencer</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="Chat"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'mSxoclNsLL8NLtvo34kDJbBy-MdYXbMMI',
      appKey: 'tLnjWwSLTZNRpGzOL7BMgXfN',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><a href="https://beian.miit.gov.cn/" target="_blank" class="is-center">冀ICP备2021024675号-1</a><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>